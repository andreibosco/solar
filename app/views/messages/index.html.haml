.block_wrapper

  = render 'message_header'
  -#= render 'message_options'

  .block_content.block_white.color_text_grey
    .align-left.padding-checkbox
      %input{:type => 'checkbox', :id => 'ckb_all'}
      Visualizar: Todos
      %i.icon-arrow-down-3
    .align-right
      = link_to ({:action => 'new', :search => @search_text}), :class =>'message_link btn btn_main', 'data-tooltip' => t(:message_new) do
        %i.icon-plus-3
      #link_mark_as_unread.btn{'data-tooltip' => t(:message_mark_as_unread), id: 'mark_as_unread'}
        %i.icon-checkmark
      - if @type != "trashbox"
        = link_to(message_path(@message.try(:id) || ':id'), {id: :link_remove_message, class: 'btn', 'data-tooltip' => t(:message_delete), method: :delete, confirm: t(:message_confirm)}) do
          %i.icon-trash
      - if @type == "trashbox"
        = link_to(restore_message_path(@message.try(:id) || ':id'), {id: :link_restore_message, class: 'btn', 'data-tooltip' => t(:message_restore), method: :put}) do
          %i.icon-trash
    .clearfix

  .block_content

    - if !@messages.nil?
      - if @messages.length > 0 
        %table.message_div_list
          - @messages.each do |message|
            %tr.message_line

              %td.message_line_check
                = check_box_tag 'checkbox_message', message.id, checked = false, {:class => 'selected_messages', :"data-message-id" => message.id}
                - if message.was_read == 't' 
                  - css_class = "message_read" 
                - else 
                  - css_class = "message_unread" 
                = hidden_field_tag 'message_style',css_class

              %td.td_subject
                - if !@search_text.empty?
                  - if message.was_sent == 't' 
                    = image_tag("icon_message_sent_small.png", :alt => " ")
                  - else 
                    = image_tag("icon_message_inbox_small.png", :alt => " ")

                - if @message_tag.nil?
                  - if !message.label.nil?
                    %span.message_label=message.label

                = link_to message.subject,  {:action => 'show', :id => message.id, :search => @search_text},{:class => css_class}
              %td.td_attachment= content_tag(:i, nil, :class=>'icon-paperclip') unless (message.has_attachment=="0")
              %td.td_sender= link_to message.sender,  {:action => 'show', :id => message.id, :search => @search_text}
              %td.td_time= link_to l(message.send_date, :format => :short),  {:action => 'show', :id => message.id, :search => @search_text}
      - else
        .text_none= t(:message_none)
    - else
      .text_none= t(:message_none)

  .message_div_navigation
    - t = @type.nil? ? "" : @type
    - s = @search_text.nil? ? "" : @search_text
    - p = 'type=' << t << '&search=' << s
    =raw render_pagination_bar(@messages_count, p)

:javascript
  $(document).ready(function(){
    dropdown_menu();

    // selecionar todos
    $('#ckb_all').click(function(){
      var c = this.checked;
      $('[type=checkbox]').each(function(){
        this.checked = c;
      });
    });

    $('#mark_as_read').click(function(){
      // todos os ids selecionados
      var message_ids = $('[type=checkbox]:checked').not(':first').map(function(){ return $(this).data('message-id') }).get();
      if (!message_ids.length) {
        return false;
      }
      console.log(message_ids);
    });

    $("#check_read").click(function() {
      $(".selected_messages").each(function(i){
        style_message = $(this).next("#message_style").val();
        if (style_message == "message_read")
          $(this).attr("checked","checked");
        else
           $(this).removeAttr("checked");
      });
   });

   $("#check_unread").click(function() {
     $(".selected_messages").each(function(i){
        style_message = $(this).next("#message_style").val();
        if (style_message == "message_read")
          $(this).removeAttr("checked");
        else
          $(this).attr("checked","checked");
      });
   });

  });
