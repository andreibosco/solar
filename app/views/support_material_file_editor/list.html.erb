<div class="block_wrapper">
    <div id="breadcrumb_wrapper">
      <div class="breadcrumb_item select_option_editor_active">
        <%= user_session[:tabs][:active] %> ->
        <%= @semester_current  %> ->
        <% @select_options_editor.each do |loc| %>
          Polos <%= loc['code'] + " " %>
          <% break %>
        <% end %>
      </div>
    </div>

    <div class="block_content" id="column_wrapper">
      <div class="select_editor curriculum_units">
        <div class="select_editor_title">
          Unidade Curricular
        </div>
        <div class="select_editor_content">
          <ul>
            <li class="select_option_editor_active" id="<%= 'curriculum'+@select_options_editor[0]['curriculum_unit_id']%>">
                <%= link_to_if(params[:type_value_id].to_s != 'curriculum_unit', @select_options_editor[0]['curriculum_unit'], :href => '#', :curriculum_unit_id => @select_options_editor[0]['curriculum_unit_id'], :choosed_type_id => 'curriculum'+@select_options_editor[0]['curriculum_unit_id'], :value_id => @select_options_editor[0]['curriculum_unit_id'], :type_value_id => 'curriculum_unit', :support_document => params[:support_document]) do
                  link_to(@select_options_editor[0]['curriculum_unit'], :href => '#', :value_id => nil, :curriculum_unit_id => nil, :choosed_type_id => nil, :support_document => params[:support_document])
                end
                %>
            </li>
          </ul>
        </div>
      </div>
      <div class="select_editor offers">
        <div class="select_editor_title">
          Oferta
        </div>
        <div class="select_editor_content">
          <ul>
            <% @select_options_editor.each do |t| %>
              <% if t['curriculum_unit_id'] == params[:curriculum_unit_id] %>
            <li class="select_option_editor_active"id="<%= 'offer'+t['offer_id'] %>">
                      <%= link_to_if(params[:offer_id] != t['offer_id'], t['semester'], :href => '#', :offer_id => t['offer_id'], :curriculum_unit_id => t['curriculum_unit_id'], :value_id => t['offer_id'], :type_value_id => 'offer', :choosed_type_id => 'offer'+t['offer_id'], :support_document => params[:support_document]) do
                        link_to(t['semester'], :href => '#', :offer_id => nil, :choosed_type_id => 'curriculum'+@select_options_editor[0]['curriculum_unit_id'], :support_document => params[:support_document])
                      end
                      %>
                  </li>
              <% end %>
            <% end %>
          </ul>
        </div>
      </div>
      <div class="select_editor groups">
        <div class="select_editor_title">
          Turma
        </div>
        <div class="select_editor_content">
          <ul>
            <% @select_options_editor.each do |t| %>
              <% if t['offer_id'] == params[:offer_id] %>
            <li class="select_editor_item_current" id="<%= 'group'+t['group_id'] %>">
                  <%= link_to t['code'], :href => '#', :value_id => t['group_id'], :type_value_id => 'group', :offer_id => t['offer_id'], :curriculum_unit_id => t['curriculum_unit_id'], :choosed_type_id => 'group'+t['group_id'], :support_document => params[:support_document] %>
                </li>
              <% end %>
            <% end %>
          </ul>
        </div>
      </div>
    </div>
</div>

<span style="font-size: 11px;font-style: italic;color: #4B6380;"> <%= link_to "Baixar todo o material de apoio como zip", :controler => :support_material_file, :action => :download_all_file_ziped %> </span>
<br/>
<% @folders_list.each do |folder_name, folder_content| %>
<!--
  --------------- >ABAIXO SEGUIR A TENTATIVA DE SELEÇÃO DO MATERIAL VISUALIZADO
-->
  <div class="block_wrapper">
    <div class="block_title">
      <h2><%= folder_name %> </h2>
      <% unless folder_name == 'LINKS' %>
      <div style="font-size: 11px;font-style: italic;color: #4B6380; float:right;">
        <%= link_to "Baixar toda a pasta como zip", :controler => :support_material_file, :action => :download_folder_file_ziped, :folder=> folder_name  %>
      </div>
        <% end %>
    </div>

    <table class='tb_list' border='0' cellpadding='10' cellspacing='0' width='100%'>
      <thead>
        <tr>
          <th><%= t(:name) %></th>
          <th style="width:80px"><%= t(:size) %></th>
          <th style="width:80px"><%= t(:sent_in) %></th>
          <th style="width:80px"><%= "Opções" %></th>
        </tr>
      </thead>
      <tbody>
        <% folder_content.each do |file| %>

    <% renderize_list = true %>
    <% if params[:type_value_id] == 'curriculum_unit' && file['allocation_tag_id'] != AllocationTag.find_all_by_curriculum_unit_id(params[:value_id])[0].id # O usuário está no nível do Curriculum Unit %>
      <% renderize_list = false %>
    <% elsif params[:type_value_id] == 'offer' && file['allocation_tag_id'] != AllocationTag.find_all_by_offer_id(params[:value_id])[0].id && file['allocation_tag_id'] != AllocationTag.find_all_by_curriculum_unit_id(params[:curriculum_unit_id])[0].id %>
      <% renderize_list = false %>
    <% end %>
        <%  renderize_list = true if params[:curriculum_unit_id].nil? %>
        <% if renderize_list %>
            <tr class="lines">
              <td>
                <% if file['url'] == nil %>
                  <%= link_to image_tag(icon_attachment(file["attachment_file_name"])),
                    {:controller => :support_material_file, :action => :download, :id => file['id'], :file_allocation_tag_id => file['allocation_tag_id']},
                    {:class => 'file_icon'} %>
                  <%= link_to file['attachment_file_name'],:controller => :support_material_file, :action => :download, :id => file['id'], :file_allocation_tag_id => file['allocation_tag_id'] %>

                 <% else %>
                  <img alt="" src="/images/icon_file_link.png" />&nbsp;
                  <a href="<%= file['url'] %>" target="_blank"><%= file['url'] %></a>
                <% end %>
              </td>
              <td>
                <% if file['url'] == nil %>
                  <%= format('%.2f KB', file["attachment_file_size"].to_i/1024.0) %>
                <% else %>
                  <!-- O tamanho não é exibido -->
                <% end %>

              </td>
              <td>
                <%=l file["attachment_updated_at"].to_time, :format => :files %>
              </td>
              <td>
                <%= link_to "Excluir" ,{:action => :delete_select_file , :id =>file["id"]}, :confirm => "Tem certeza que deseja excluir ?", :method => :delete %>
                <span onclick="showLightBox('Trocar por URL para edição', 400, 300, true, 'Editar link'); return false;"> /Editar</span>
              </td>
            </tr>
            <% end %>
        <% end %>
      </tbody>
    </table>
  </div>
<% end %>

<% if @folders_list.nil? or @folders_list.empty? %>
  <div class="block_content block_content_text"><%= t(:itens_not_found) %></div>
<% end %>

<!-- Enviar arquivo e manipulação das pastas -->
  <br/>
  <%#= user_session[:tabs][:active] %>
<%#= @editor_general_data %><br/>
<%#= @select_curriculum_editor %>
<%#= params[:support_material] %>
<%= raw render_support_controll_tab %>
<%#= @list_files %>
<%= params[:value_id] %>
<%#= current_user.id %>
<%#= params[:choosed_type_id] %>
<%#= curriculum_unit_id = user_session[:tabs][:opened][user_session[:tabs][:active]][:url]['id'] %>
<%#= allocation_tag_id = user_session[:tabs][:opened][user_session[:tabs][:active]][:url]['allocation_tag_id'] %>
<%#= @folders_list %>
<%#= active_tab = user_session[:tabs][:opened][user_session[:tabs][:active]] %> <!-- Curriculum Unit Id --><br/>
<%#= active_tab[:url]['id'] %>
<%#= @select_options_editor %> <br/>

<div class="support_link">
  <% if params[:support_document] == 'document' || params[:support_document].nil? %>
    <%= render 'document' %>
  <%  elsif params[:support_document] == 'paste' %>
    <%= render 'paste' %>
  <%  elsif params[:support_document] == 'link' %>
    <%= render 'link' %>
  <% end %>
</div>

<!-- Manipula o select do editor -->


<script type="text/javascript">
  var bread_select;
  $(".select_editor_content a").click(function(){
    var parentColumn = $(this).parents('.select_editor').next();
    console.log(parentColumn);
    $(parentColumn).animate({ opacity: 'toggle', width: 'toggle' });
    });
</script>

<% if params[:value_id] == nil %>
  <script type="text/javascript">
    $("#breadcrumb_wrapper .breadcrumb_item").click(function() {
        $(this).parent().fadeOut(function(){
            $(this).next('#column_wrapper').fadeIn();
        })
      })
  </script>
<%else%>
  <script type="text/javascript">
    $(document).ready(function(){
      $("#breadcrumb_wrapper .breadcrumb_item").parent().fadeOut(function(){
          $(this).next('#column_wrapper').fadeIn();
          $('#'+'<%= params[:choosed_type_id] %>').css('background', '#fffbe4');
      });
    })
  </script>
<%end%>
