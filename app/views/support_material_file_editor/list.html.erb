<script type ="text/javascript">

  $(document).ready(function(){
  $('#select_folder').change(function(){
  if($('#select_folder option:selected').text() == "nova pasta"){
  $('#new_folder').fadeIn();
  } else{
  $('#new_folder').fadeOut();
  }
  });
  });
</script>


<span>Material de apoio do editor</span>

<div>

  <br/>
  <span> Oferta: </span>
  <div style="margin-left: 50px;margin-top: -20px;">
    <%= form_for(@offers) do |f| %>
      <%= f.select :offer, options_for_select([""] + Offer.find(:all,:select => "semester").collect{|c| [c.semester]})%>
    <%end%>
  </div>

  <span> Turma: </span>
  <div style="margin-left: 50px;margin-top: -20px;">
    <%= form_for(@groups) do |f| %>
      <%= f.select :group, options_for_select([""] + Group.find(:all,:select => "code").collect{|c| [c.code]})%>
    <%end%>
  </div>

  <hr/>
  <br/>

  <% #Link %>
  <% form_for :link, :url => {:controller => "support_material_file_editor", :action => "upload_link"} do |flink| %>
    <span>Link:</span>
    <div style="margin-left: 70px;margin-top: -25px;">
      <%= flink.text_field :link, :id => "link"%>
    </div>
    <div style="margin-left: 300px; margin-top: -30px">
      <%= flink.submit t(:confirm), :id=>"confirm", :class=>"btn btn_default", :alt=> t(:confirm) %>
    </div>
  <%end%>

  <br/>

  <% #Arquivo %>
  <div>
    <span>Arquivo:</span>
    <br/>
    <div>
      <%= form_for(:support_material, :html => { :multipart => true }, :url => {:controller => :support_material_file_editor,
          :action => :upload_files }) do |f| %>
        <%= f.file_field :attachment%>
      </div>

      <br/>
      <span>Pasta:</span>
      <div id="select_folder">
        <%= f.select :folder, options_for_select([""] + ["nova pasta"] + SupportMaterialFile.find(:all,:select => "DISTINCT folder", :conditions => ["folder != ? and folder != ? ", "","LINKS"]).collect{|c| [c.folder]})%>
      </div>

      <div id ="new_folder" style="display: none">
        <div> Nova pasta </div>
        <%= f.text_field :new_folder%>
      </div>

      <br/>

      <span>
        <%= f.submit t(:send), :id => "support_material", :class => "btn btn_default"%>
      </span>

    <% end %>


  </div>
</div>

<br/>
<hr/>

<% "----------------------------------------------------------------------------------------------------------------------------" %>
<% "VERIFICAR MELHOR FORMA DE RENDERIZAR ESSA PÁGINA" %>

<h2> Material de apoio enviado </h2>
<br/>
<span style="font-size: 11px;font-style: italic;color: #4B6380;"> <%= link_to "Baixar todo o material de apoio como zip", :controler => :support_material_file, :action => :download_all_file_ziped %> </span>
<br/>
<% @folders_list.each do |folder_name, folder_content| %>
  <div class="block_wrapper">
    <div class="block_title">
      <h2><%= folder_name %> </h2>
      <% unless folder_name == 'LINKS' %>
        <span style="font-size: 11px;font-style: italic;color: #4B6380;"> <%= link_to "Baixar toda a pasta como zip", :controler => :support_material_file, :action => :download_folder_file_ziped, :folder=> folder_name  %> </span>
      <% end %>
    </div>

    <table class='tb_list' border='0' cellpadding='10' cellspacing='0' width='100%'>
      <thead>
        <tr>
          <th><%= t(:name) %></th>
          <th style="width:80px"><%= t(:size) %></th>
          <th style="width:80px"><%= t(:sent_in) %></th>
          <th style="width:80px"><%= "Opções" %></th>
        </tr>
      </thead>
      <tbody>
        <% folder_content.each do |file| %>
          <tr class="lines">
            <td>
              <% if file['url'] == nil %>
                <%= link_to image_tag(icon_attachment(file["attachment_file_name"])),
                  {:controller => :support_material_file, :action => :download, :id => file['id'], :file_allocation_tag_id => file['allocation_tag_id']},
                  {:class => 'file_icon'} %>
                <%= link_to file['attachment_file_name'],:controller => :support_material_file, :action => :download, :id => file['id'], :file_allocation_tag_id => file['allocation_tag_id'] %>

              <% else %>
                <img alt="" src="/images/icon_file_link.png" />&nbsp;
                <a href="<%= file['url'] %>" target="_blank"><%= file['url'] %></a>
              <% end %>
            </td>
            <td>
              <% if file['url'] == nil %>
                <%= format('%.2f KB', file["attachment_file_size"].to_i/1024.0) %>
              <% else %>
                <!-- O tamanho não é exibido -->
              <% end %>

            </td>
            <td>
              <%=l file["attachment_updated_at"].to_time, :format => :files %>
            </td>
            <td>
              <%= link_to "Excluir" ,{:action => :delete_select_file , :id =>file["id"]}, :confirm => "Tem certeza que deseja excluir ?", :method => :delete %>
              <span onclick="showLightBox('Trocar por URL para edição', 400, 300, true, 'Editar link'); return false;"> /Editar</span>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
<% end %>

<% if @folders_list.nil? or @folders_list.empty? %>
  <div class="block_content block_content_text"><%= t(:itens_not_found) %></div>
<% end %>
