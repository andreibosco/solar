= javascript_include_tag "jquery"
= javascript_include_tag "jquery-ui-1.8.6"
= javascript_include_tag "jquery.tokeninput"
= javascript_include_tag "jquery.dynatree"
= javascript_include_tag "lesson_files"

= stylesheet_link_tag "ui.dynatree"
= stylesheet_link_tag "ui.dynatree.custom"

#lesson_file_management
  - files_and_folders(@lesson)

  :javascript
    var treeData             = #{@files};
    var folderTreeData       = #{@folders};
    var initial_file_address = "#{@address}";
    var extensions           = #{Solar::Application.config.black_list[:extensions]};

  = hidden_field_tag :remove_path, remove_node_lesson_files_path(lesson_id: @lesson.id)
  = hidden_field_tag :rename_path, rename_node_lesson_files_path(lesson_id: @lesson.id)
  = hidden_field_tag :move_path, move_nodes_lesson_files_path(lesson_id: @lesson.id)
  = hidden_field_tag :lesson_path, list_lessons_path
  = hidden_field_tag :upload_files_path, upload_lesson_files_path(lesson_id: @lesson.id)

  = form_for(:lesson_files, :url => upload_lesson_files_path(lesson_id: @lesson.id), :html => {id: "file_form", :method => :put }) do |f|
    = f.file_field :files, id: "fileupload", multiple: true
    = f.hidden_field :path, id: "path"

  .flash_messages

  %div#files_menu_bar
    #files_select
      = check_box_tag :all_items_selector
      %span#lesson_files_select_all= t(".all")
    .btn-group
      %a.btn.btn_main#btn-new-file
        = content_tag(:i, nil, :class=>'icon-plus-3')
    .btn-group
      = button_tag content_tag(:i, nil, :class=>'icon-star'), type: :button, :class => 'btn', id: "btn-initial-file"
    .btn-group
      = button_tag content_tag(:i, nil, :class=>'icon-folder'), type: :button, :class => 'btn', id: "btn-new-folder", value: new_folder_lesson_files_path(:lesson_id => @lesson.id)
      = button_tag content_tag(:i, nil, :class=>'icon-archive'), type: :button, :class => 'btn', id: "btn-unzip"
      = button_tag content_tag(:i, nil, :class=>'icon-edit'), type: :button, :class => 'btn', id: "btn-rename"
      = button_tag content_tag(:i, nil, :class=>'icon-trash'), type: :button, :class => 'btn btn_caution', id: "btn-remove-node"
      = button_tag content_tag(:i, nil, :class=>'icon-move'), type: :button, :class => 'btn', id: "btn-move-node"
      %span#folder_window
        %span#window_title= t(".move_to")
        %span#folders_tree
        %span#folder_window_buttons
          = button_tag t(".cancel"), type: :button, :class => 'btn', id: "btn-cancel-move"
          = button_tag t(".move"), type: :button, :class => 'btn btn_main', id: "btn-save-move"
      
  #tree

  #files_bottom_bar
    = button_tag t(".conclude"), type: :button, :class => 'btn btn_main', id: "btn-finish"  
