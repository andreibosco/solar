<!-- Portlet da Unidade Curricular que exibe a agenda da mesma -->
<%
#Portlet de exibição do calendário com os eventos.
%>
<div id="agenda_portlet" class="curriculum_unit_portlets_small">
  <div class="curriculum_unit_portlet_small_header">
    <%= image_tag "icon_agenda.png", :alt=>t(:icon_agenda) %>
    <%= t(:curriculum_access_agenda)%>
  </div>
  <div class="calendar" id="agenda"></div>
  <div class="calendar_events">
    <!-- Classe que carrega o Ajax -->
  </div>

  <script type="text/javascript">

    function updateMonthlyEvents(year, month){
      var all_dates = <%=raw @scheduled_events%>;

      //coloca datas que possuem evento realcadas
      $(all_dates).each(function(i, d) {
        $(".ui-state-default").each(function() {
            var date_comparison = $(this).text() + '/' + month + '/' + year;            
            if (date_comparison == d ) {
              $(this).attr('style', 'background: #F9C153;');
            }
        });
      });
      alert("fim");
    }


    function changeDate(dateText){

      var valor_recuperado = dateText; //$(this).val();

      $.get('/schedules/show', {
        date: valor_recuperado,
        id: <%= @curriculum_unit.id %>
      },
      function(response) {
        $('.calendar_events').html(response);
      });
    }

    function showAgenda(){
      // carregando eventos de hoje
      var today = new Date();
      changeDate(today.toGMTString());

      var local = '<%=I18n.locale%>';
      var locale = $.datepicker.regional[local];
      if (local=='en') {
        locale = $.datepicker.regional['en-GB']
      }

      $("#agenda").datepicker({
        option: locale,
        onSelect: function(dateText, inst) {
          changeDate(dateText);
        },
        onChangeMonthYear: function(year, month, inst) {
          updateMonthlyEvents(year, month);
        }
      });
      
      //getMonth: 0 - 11
      updateMonthlyEvents(today.getFullYear(), today.getMonth()+1);
    }

    $(function() {
      showAgenda();
    });

  </script>

</div>
