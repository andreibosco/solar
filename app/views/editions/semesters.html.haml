= javascript_include_tag "autocomplete"
= stylesheet_link_tag "autocomplete"
= stylesheet_link_tag "http://code.jquery.com/ui/1.10.3/themes/smoothness/jquery-ui.css"

.edition
  %fieldset#allocation_tag_selection
    %legend= t(".filter")
    .filter_notice= t(".select_something")
    %span.label
      = [t(:type, scope: [:editions, :academic]), @type.description].join(": ")
    .filter_courses
      .course
        = select_tag :course, options_from_collection_for_select(@courses, 'id', 'name'), include_blank: true
      %br/
      .curriculum_unit
        = select_tag :curriculum_unit, options_from_collection_for_select(@curriculum_units, 'id', 'name'), include_blank: true
      %br/
      .period
        = select_tag :period, options_for_select(@periods, @periods.first)

      %br/
      = link_to t(:search), "#", {class: 'btn', :"data-url-search" => semesters_path, id: 'search'}

.semesters_list
  = render "semesters/list"

= render "back"

:javascript

  $(function(){
    $("#curriculum_unit, #course, #period").combobox();
    $("#period").combobox('value', "#{@periods.first.last}");


    $('#period').combobox({
      change: function(event, ui) {
        if(ui.item == null)
          $(this).combobox('value', 'active');
      }
    });


    $('#search').click(function(){

      if(($('#period').combobox('value') == "all" && $('#curriculum_unit').is_empty() && $('#course').is_empty()))
        flash_message("#{t('.warning')}", 'alert');
      else
        erase_flash_messages();

      $.ajax({
          type: 'GET',
          url: $(this).data("url-search"),
          data: {
            curriculum_unit_id: $("#curriculum_unit").combobox('value'),
            course_id: $("#course").combobox('value'),
            period: $("#period").combobox('value')
          },
          success: function(data){
            $(".semesters_list").html(data);
          }
        });

    });
  });
