/*
Precisamos:
	- Tratar acentos;
	- Criar interdependências nas buscas
	- Trocar o tokenValue: para allocationTagId
	- Colocar as opções de cada menu num json
	- Manter valores selecionados em caso de refresh
*/


$(document).ready(function(){

	function recountItems(){
		console.log(Date() + 'Recontando...');
		$(".placesNavPanel #counter").text('99');
	
	}

	$( "#txtCourse").tokenInput(search_urls["course"], {
		hintText: hints["course"],
		searchingText: messages["searching"],
		queryParam : 'search',
		propertyToSearch: 'name',
		tokenValue: 'id', //trocar por allocationTagId
		preventDuplicates: 'true',
		noResultsText: messages["noResults"],
		onAdd: function (item) {
            recountItems();
        },
        onDelete: function (item) {
            recountItems();
        }
	});
	
	$( "#txtSemester").tokenInput("http://shell.loopj.com/tokeninput/tvshows.php", {
		hintText: hints["semester"],
		searchingText: messages["searching"],
		noResultsText: messages["noResults"]
	});
	$( "#txtCurriculumUnit").tokenInput("http://localhost:3000/curriculum_units/list.json", {
		hintText: hints["curriculumUnit"],
		searchingText: messages["searching"],
		queryParam : 'search',
		propertyToSearch: 'name',
		tokenValue: 'id', //trocar por allocationTagId
		preventDuplicates: 'true',
		noResultsText: messages["noResults"]
	});
	$( "#txtGroup").tokenInput("http://shell.loopj.com/tokeninput/tvshows.php", {
		hintText: hints["group"],
		searchingText: messages["searching"],
		noResultsText: messages["noResults"]
	});

	$('.placesNavPanel input[type="button"]').click(function(){
		showNavPanelMenu(this);
	});

	$(window).click(function(e){
		if ($(e.target).parents('#navPanelMenu').length == 0 && $(e.target).filter('.placesNavPanel input[type="button"]').length == 0)
			$('#navPanelMenu').remove();	
	});

});

function showNavPanelMenu(element){
	if ($('#navPanelMenu').length)
		$('#navPanelMenu').remove();

	var pnl = '<ul id="navPanelMenu" style="display:none;opacity:0.9">';
	pnl += '<li><a href="#" onclick="return false;">[Novo]</a></li>';
	pnl += '<li><a href="#" onclick="return false;">[Alterar]</a></li>';
	pnl += '<li><a href="#" onclick="return false;">[Excluir]</a></li>';
	pnl += '<li><a href="#" onclick="return false;">[Ofertar]</a></li>';
	pnl += '</ul>';

	//var left = $(element).position().left + $(element).outerWidth();
	$('body').append(pnl);
	
	console.log(element);
	//$('#navPanelMenu').css('left', ''+ left + 'px')
	$('#navPanelMenu').position({
		my: 'left top',
		at: 'right top',
		of: $(element)
	});

	$('#navPanelMenu').slideDown('fast');
	//console.log(pnl);
	//console.log($('#navPanelMenu'));
}



