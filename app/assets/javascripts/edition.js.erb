function call_page(url){
  $.get(url, function(data) {
    $('#curriculum_unit_items').html(data);
  });
}

function back_to_edition(){
  $.ajax({
    type: 'GET',
    url: '#{editions_path}',
    data: {'layout': false},
    success: function(data) {
      $(".edition_div").html(data);
    }
  });
}

function open_lightbox1(url, title){
  showLightBoxURL(url, 550, 255, true, title);
}

function open_lightbox2(url, title){
  showLightBoxURL(url, 540, 605, true, title);
}

function open_lightbox3(url, title){
  showLightBoxURL(url, 540, 157, true, title);
}

function submit_form(form_id, class_to_update_fail, controller){
  var div_to_update_success = div_to_update(controller);

  $.ajax({
    type: "POST",
    url: $("#"+form_id).attr("action"),
    data: $("#"+form_id).serialize(),
    success: function(data) {
      // se o resultado conter uma div de erro 
      if(data.search(".access_denied") != -1){
        removeLightBox();  
        // atualiza div da página de edição com conteúdo de listagem
        $("#"+div_to_update_success).html(data);
        // se é o controller de fóruns
        if(controller == 'discussion'){
          // mensagem de não pode editar (se for criação, a div nunca existirá)
          flash_message('<%= I18n.t(:cant_edit, :scope => [:discussion, :errors]) %>', 'alert');
        }else{
          // mensagem de acesso negado
          flash_message('<%= I18n.t(:no_permission) %>', 'alert');
        }
      }else{
        // se existir algum erro, o simple_form acrescenta a classe "error" aos campos
        if(data.search(".error") != -1){
          // atualiza conteúdo com o formulário
          $("."+class_to_update_fail).html(data);
        // se não existir erros
        }else{
          removeLightBox();  
          // atualiza div da página de edição com conteúdo de listagem
          $("#"+div_to_update_success).html(data);
          // mensagem de sucesso
          flash_message('<%= I18n.t(:saved, :scope => [:editions, :success]) %>', 'notice');
        }
      }
    }
  });
}

function delete_object(url, div_to_update){
  if(confirm('<%= I18n.t(:are_you_sure_of_deletion, :scope => [:editions]) %>')){
    $.ajax({
      type: "DELETE",
      url: url,
      success: function(data) {
        // atualiza div da página de edição com conteúdo de listagem
        $("#"+div_to_update).html(data);
        // se existir algum erro após deleção
        if(data.search(".error_deletion") != -1){
          // aviso de erro
          flash_message($(".error_deletion").html(), 'alert');
        // se não existir erros
        }else{
          // aviso de sucesso
          flash_message('<%= I18n.t(:deleted, :scope => [:editions, :success]) %>', 'notice');
        }
      }
    });
  }
}

function div_to_update(controller){
  if(controller == "curriculum_unit"){
    var div_to_update = 'list_curriculum_units';
  }else{
    if(controller == "offer"){
      var div_to_update = 'list_offers';
    }else{
      var div_to_update = 'curriculum_unit_items';
    }
  }
  return div_to_update;
}