// = require maskedinput

jQuery(document).ready(function() {
  jQuery("#offer_semester").mask("9999.9");  
});

jQuery(function($) {

  if($("input:checkbox").attr("checked") == "checked")
    $(".enroll_end").show();
  else
    $(".enroll_end").hide();

  /* Usado no formulário */

  var options = $.extend({}, $.datepicker.regional['#{I18n.locale}'], {dateFormat: global_config.locale.dateFormat.default});

  // Impede que o usuário selecione uma data final menor que inicial e uma inicial maior que a final
  $('#dt_start_date').datepicker( $.extend({}, options, { onSelect: function(selected) { $('#dt_end_date').datepicker("option", "minDate", selected); } }) );
  $('#dt_end_date').datepicker( $.extend({}, options, { onSelect: function(selected) { $('#dt_start_date').datepicker("option", "maxDate", selected); } }) );

  $('#dt_enroll_start').datepicker( $.extend({}, options, { onSelect: function(selected) { $('#dt_enroll_end').datepicker("option", "minDate", selected); } }) );
  $('#dt_enroll_end').datepicker( $.extend({}, options, { onSelect: function(selected) { $('#dt_enroll_start').datepicker("option", "maxDate", selected); } }) );

  $("#save").click(function(){
    submit_form('offer_form', 'offer_form', '#{offers_path}', 'list_offers');
  });

  $("#cancel").click(function(){
    removeLightBox();
  });

  /* Usado na listagem */
  $('.edit').click(function(){
    open_lightbox3($(this).parent().attr('action'), "<%= I18n.t(:edit_offer, :scope => [:offers, :index]) %>");
  });

  $('.deactivate_groups').click(function(){
    $.ajax({
      type: 'POST',
      url: $(this).parent().attr('action'),
      success: function(data){
        $("#list_offers").html(data);
        flash_message("<%= I18n.t(:all_groups_deactivated, :scope => [:offers, :index]) %>", 'notice');
      },
      error: function(){
        flash_message("<%= I18n.t(:cant_deactivate, :scope => [:offers, :index]) %>", 'alert');
      }
    });
  });

  $("input:checkbox").change(function() {
    if (this.checked){
      set_dates_like_offer();
      $(".enroll_end").slideDown();
    }else
      $(".enroll_end").slideUp();
  });

  $("input[id^='dt_enroll']").change(function() {
    if($("#dt_enroll_start").datepicker("getDate") == null || $("#dt_enroll_end").datepicker("getDate") == null)
      set_dates_like_offer();
  });

  /* Seta as datas de período de matrícula com valores pré-definidos quando estas são definidas como vazias */
  function set_dates_like_offer(){
    if($("#dt_enroll_start").datepicker("getDate") == null)
      $("#dt_enroll_start").datepicker("setDate", $("#dt_start_date").datepicker("getDate"));
    if($("#dt_enroll_end").datepicker("getDate") == null)
      $("#dt_enroll_end").datepicker("setDate", $("#dt_end_date").datepicker("getDate"));
  }

});
